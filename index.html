<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ulangan Harian Sejarah - SMA Negeri 5 Tanah Putih</title>
    <style>
        /* RESET & DASAR */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: #333;
            min-height: 100vh;
            padding: 15px;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* CONTAINER UTAMA */
        .container {
            max-width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            padding: 20px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 3px solid #1a237e;
            margin-bottom: 20px;
        }
        
        .school-logo {
            max-width: 100px;
            height: auto;
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .school-name {
            color: #1a237e;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 5px;
            line-height: 1.3;
        }
        
        .school-location {
            color: #5c6bc0;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        .exam-title {
            background: #1a237e;
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 18px;
        }

        /* KOTAK INFORMASI */
        .info-box {
            background: #e8eaf6;
            border-left: 5px solid #3949ab;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .info-box h3 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-box ul {
            padding-left: 20px;
        }
        
        .info-box li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        /* PERINGATAN */
        .warning-box {
            background: #fff8e1;
            border: 2px solid #ffb300;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .warning-box h3 {
            color: #ff6f00;
            margin-bottom: 8px;
            font-size: 16px;
        }

        /* FORM INPUT */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a237e;
            font-size: 15px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #c5cae9;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .form-input:focus {
            border-color: #3949ab;
            outline: none;
        }

        /* CHECKBOX */
        .checkbox-container {
            display: flex;
            align-items: flex-start;
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .checkbox-container input {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            margin-top: 2px;
        }
        
        .checkbox-label {
            color: #d32f2f;
            font-weight: 600;
            font-size: 14px;
            line-height: 1.4;
        }

        /* TOMBOL */
        .btn {
            display: block;
            width: 100%;
            background: linear-gradient(to right, #1a237e, #3949ab);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
            text-align: center;
            text-decoration: none;
        }
        
        .btn:hover {
            background: linear-gradient(to right, #3949ab, #1a237e);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(57, 73, 171, 0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-finish {
            background: linear-gradient(to right, #388e3c, #4caf50);
        }
        
        .btn-finish:hover {
            background: linear-gradient(to right, #4caf50, #388e3c);
        }
        
        .btn-danger {
            background: linear-gradient(to right, #d32f2f, #f44336);
        }
        
        .btn-danger:hover {
            background: linear-gradient(to right, #f44336, #d32f2f);
        }

        /* HALAMAN SOAL */
        .question-container {
            display: none;
        }
        
        .timer-container {
            background: #1a237e;
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: 700;
        }
        
        .question-number {
            background: #3949ab;
            color: white;
            display: inline-block;
            padding: 8px 16px;
            border-radius: 50px;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .question-text {
            font-size: 18px;
            line-height: 1.5;
            margin-bottom: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .options-container {
            margin-bottom: 25px;
        }
        
        .option {
            display: block;
            padding: 15px;
            margin-bottom: 10px;
            background: #e8eaf6;
            border: 2px solid #c5cae9;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 16px;
        }
        
        .option:hover {
            background: #c5cae9;
            transform: translateX(5px);
        }
        
        .option.selected {
            background: #3949ab;
            color: white;
            border-color: #1a237e;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e0e0e0;
        }
        
        .nav-btn {
            padding: 12px 20px;
            font-size: 16px;
            width: 48%;
        }

        /* INDIKATOR SOAL */
        .question-indicators {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .indicator {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0e0e0;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .indicator.answered {
            background: #4caf50;
            color: white;
        }
        
        .indicator.current {
            background: #3949ab;
            color: white;
            transform: scale(1.1);
        }

        /* HALAMAN HASIL */
        .results-container {
            display: none;
            text-align: center;
            padding: 20px 0;
        }
        
        .results-title {
            color: #1a237e;
            font-size: 24px;
            margin-bottom: 25px;
        }
        
        .score-circle {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: conic-gradient(#4caf50 0% 70%, #ff9800 70% 90%, #f44336 90% 100%);
            margin: 0 auto 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .score-inner {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .score-value {
            font-size: 42px;
            font-weight: 700;
            color: #1a237e;
        }
        
        .score-label {
            font-size: 16px;
            color: #5c6bc0;
        }
        
        .results-details {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 25px 0;
        }
        
        .result-box {
            background: #e8eaf6;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .result-box h3 {
            color: #1a237e;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .result-value {
            font-size: 32px;
            font-weight: 700;
            color: #3949ab;
        }
        
        .result-label {
            font-size: 14px;
            color: #5c6bc0;
            margin-top: 5px;
        }

        /* PERINGATAN */
        .fullscreen-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }
        
        .cheating-warning {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: #d32f2f;
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            z-index: 10001;
            display: none;
        }

        /* FOOTER */
        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
            color: #757575;
            font-size: 12px;
            line-height: 1.4;
        }

        /* RESPONSIVE */
        @media (min-width: 768px) {
            .container {
                max-width: 700px;
                padding: 30px;
            }
            
            .school-name {
                font-size: 28px;
            }
            
            .results-details {
                flex-direction: row;
                justify-content: center;
            }
            
            .result-box {
                min-width: 180px;
            }
            
            .nav-btn {
                width: auto;
                padding: 12px 30px;
            }
        }

        /* ANIMASI */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }

        /* LOADING */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10002;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3949ab;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div id="loading-text">Mengirim hasil...</div>
    </div>

    <!-- Peringatan Kecurangan -->
    <div id="cheating-warning" class="cheating-warning">
        ‚ö†Ô∏è PERINGATAN: Aktivitas mencurigakan terdeteksi!
    </div>

    <!-- Peringatan Layar Penuh -->
    <div id="fullscreen-warning" class="fullscreen-warning">
        <h2 style="color: #ff9800; margin-bottom: 20px; font-size: 24px;">ULANGAN HARIAN</h2>
        <p style="font-size: 18px; margin-bottom: 15px; max-width: 500px;">Ulangan ini harus dikerjakan dalam mode layar penuh untuk menjaga integritas ujian.</p>
        <p style="font-size: 16px; margin-bottom: 30px; color: #ffcc80;">Pastikan Anda sudah siap sebelum melanjutkan.</p>
        <button id="enter-fullscreen-btn" class="btn" style="width: auto; padding: 15px 40px;">MULAI ULANGAN</button>
        <p style="margin-top: 20px; font-size: 14px; color: #bdbdbd;">¬© 2026 Daniel Riadi Sianipar</p>
    </div>

    <!-- Container Utama -->
    <div class="container">
        <!-- Halaman Awal -->
        <div id="start-page">
            <div class="header">
                <img src="logo.png" alt="Logo Sekolah" class="school-logo" id="school-logo">
                <h1 class="school-name">SMA NEGERI 5 TANAH PUTIH</h1>
                <h2 class="school-location">KABUPATEN ROKAN HILIR</h2>
                <div class="exam-title">
                    ULANGAN HARIAN SEJARAH<br>
                    Hindu-Buddha & Kerajaan Sunda
                </div>
            </div>
            
            <div class="info-box">
                <h3>üìã TATA CARA PENGERJAAN:</h3>
                <ul>
                    <li>Waktu: <strong>13 menit 45 detik</strong></li>
                    <li>Jumlah soal: <strong>15 pilihan ganda</strong></li>
                    <li>Pilih jawaban dengan menekan pilihan yang tersedia</li>
                    <li>Gunakan tombol navigasi untuk berpindah soal</li>
                    <li>Waktu akan terus berjalan sampai habis</li>
                </ul>
            </div>
            
            <div class="warning-box">
                <h3>‚ö†Ô∏è PERINGATAN PENTING:</h3>
                <ul>
                    <li>Kerjakan dengan <strong>JUJUR</strong> dan mandiri</li>
                    <li>Ulangan akan berjalan dalam <strong>mode layar penuh</strong></li>
                    <li><strong>DILARANG</strong> membuka tab/aplikasi lain</li>
                    <li>Hasil akan otomatis dikirim ke guru</li>
                    <li>Kecurangan akan terdeteksi secara otomatis</li>
                </ul>
            </div>
            
            <form id="student-form">
                <div class="form-group">
                    <label class="form-label">Nama Lengkap:</label>
                    <input type="text" id="student-name" class="form-input" placeholder="Masukkan nama lengkap" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kelas:</label>
                    <select id="student-class" class="form-input" required>
                        <option value="">Pilih Kelas</option>
                        <option value="10 Satu">10 Satu</option>
                        <option value="10 Dua">10 Dua</option>
                        <option value="10 Tiga">10 Tiga</option>
                        <option value="10 Empat">10 Empat</option>
                        <option value="11 Satu">11 Satu</option>
                        <option value="11 Dua">11 Dua</option>
                        <option value="11 Tiga">11 Tiga</option>
                        <option value="12 Satu">12 Satu</option>
                        <option value="12 Dua">12 Dua</option>
                        <option value="12 Tiga">12 Tiga</option>
                    </select>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="honor-statement" required>
                    <label for="honor-statement" class="checkbox-label">
                        Saya menyatakan akan mengerjakan ulangan ini dengan JUJUR, tanpa bantuan pihak lain, dan siap menerima konsekuensi jika melanggar.
                    </label>
                </div>
                
                <button type="button" id="start-exam-btn" class="btn pulse">MULAI ULANGAN</button>
            </form>
        </div>
        
        <!-- Halaman Soal -->
        <div id="exam-page" class="question-container">
            <div class="timer-container">
                ‚è± WAKTU: <span id="timer">13:45</span>
            </div>
            
            <div class="question-indicators" id="question-indicators">
                <!-- Indikator akan diisi JavaScript -->
            </div>
            
            <div id="current-question">
                <!-- Soal akan diisi JavaScript -->
            </div>
            
            <div class="navigation">
                <button id="prev-btn" class="btn nav-btn">‚Üê Sebelumnya</button>
                <button id="next-btn" class="btn nav-btn">Berikutnya ‚Üí</button>
            </div>
            
            <button id="finish-btn" class="btn btn-finish">KUMPULKAN ULANGAN</button>
        </div>
        
        <!-- Halaman Hasil -->
        <div id="results-page" class="results-container">
            <h2 class="results-title">HASIL ULANGAN HARIAN</h2>
            
            <div class="score-circle">
                <div class="score-inner">
                    <div class="score-value" id="final-score">0</div>
                    <div class="score-label">NILAI</div>
                </div>
            </div>
            
            <div class="results-details">
                <div class="result-box">
                    <h3>Jawaban Benar</h3>
                    <div class="result-value" id="correct-answers">0</div>
                    <div class="result-label">dari 15 soal</div>
                </div>
                
                <div class="result-box">
                    <h3>Waktu Digunakan</h3>
                    <div class="result-value" id="time-used">0:00</div>
                    <div class="result-label">dari 13:45</div>
                </div>
                
                <div class="result-box">
                    <h3>Status</h3>
                    <div class="result-value" style="font-size: 24px;" id="exam-status">SELESAI</div>
                    <div class="result-label" id="submission-status">Terkumpul</div>
                </div>
            </div>
            
            <div class="info-box" style="text-align: left; margin: 25px 0;">
                <h3>üìù Catatan:</h3>
                <ul>
                    <li>Hasil telah tercatat dan dikirim ke guru</li>
                    <li>Nilai dihitung otomatis: setiap soal bernilai 6.67</li>
                    <li>Detail jawaban dapat ditanyakan pada pertemuan berikutnya</li>
                    <li>Hasil ini dapat disimpan sebagai bukti pengerjaan</li>
                </ul>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
                <button id="save-pdf-btn" class="btn">üíæ Simpan Hasil</button>
                <button id="return-home-btn" class="btn">üè† Kembali ke Menu</button>
            </div>
        </div>
        
        <div class="copyright">
            ¬© 2026 Daniel Riadi Sianipar - Guru Sejarah SMA Negeri 5 Tanah Putih<br>
            Sistem Ulangan Harian Online v1.0
        </div>
    </div>

    <script>
        // ============================================
        // DATA SOAL
        // ============================================
        const questions = [
            {
                id: 1,
                question: "Teori masuknya Hindu-Buddha ke Indonesia yang menyatakan bahwa peran aktif dalam penyebaran agama dan kebudayaan dilakukan oleh kaum brahmana (pendeta) atas undangan penguasa lokal dinamakan teori...",
                options: ["Waisya", "Ksatria", "Brahmana", "Arus Balik", "Sudra"],
                correctAnswer: 2
            },
            {
                id: 2,
                question: "Salah satu bukti kuat yang mendukung teori Brahmana adalah...",
                options: [
                    "Banyaknya prasasti berbahasa Sanskerta dan huruf Pallawa.",
                    "Adanya penemuan arca-arca dewa-dewi India.",
                    "Penggunaan sistem kasta dalam masyarakat.",
                    "Ditemukannya candi-candi bercorak Hindu.",
                    "Munculnya kerajaan-kerajaan bercorak Hindu-Buddha."
                ],
                correctAnswer: 0
            },
            {
                id: 3,
                question: 'Teori "Arus Balik" yang dikemukakan oleh F.D.K. Bosch menekankan pada peran...',
                options: [
                    "Pedagang India yang menetap dan menikah dengan penduduk lokal.",
                    "Bangsa Indonesia sendiri yang aktif belajar ke India dan kembali menyebarkan ilmunya.",
                    "Kaum ksatria India yang kalah perang lalu mengungsi ke Nusantara.",
                    "Para brahmana yang diundang secara khusus untuk menobatkan raja.",
                    "Misionaris agama Buddha dari India yang menyebarkan ajaran."
                ],
                correctAnswer: 1
            },
            {
                id: 4,
                question: "Salah satu perubahan signifikan dalam kehidupan politik masyarakat Indonesia setelah masuknya pengaruh Hindu-Buddha adalah...",
                options: [
                    "Sistem pemerintahan kesukuan digantikan oleh sistem kerajaan (monarki).",
                    "Munculnya demokrasi langsung di tingkat desa.",
                    "Kekuasaan dipegang sepenuhnya oleh dewan perang.",
                    "Pemimpin dipilih berdasarkan kekayaan dan kepemilikan tanah.",
                    "Sistem pemerintahan menjadi teokrasi yang dipimpin oleh pendeta."
                ],
                correctAnswer: 0
            },
            {
                id: 5,
                question: "Dalam bidang ekonomi, masuknya pengaruh Hindu-Buddha memperkuat kegiatan...",
                options: [
                    "Pertanian subsisten di pedalaman.",
                    "Perburuan dan meramu.",
                    "Pelayaran dan perdagangan antarpulau serta internasional.",
                    "Industri manufaktur berskala besar.",
                    "Ekonomi barter dalam skala kecil."
                ],
                correctAnswer: 2
            },
            {
                id: 6,
                question: "Walaupun pengaruh Hindu-Buddha kuat, unsur-unsur kebudayaan asli Indonesia (lokal) tetap bertahan dan berakulturasi. Hal ini dapat dilihat dari...",
                options: [
                    "Bentuk candi seperti Prambanan dan Borobudur yang memiliki unsur punden berundak.",
                    "Penggunaan bahasa Sanskerta secara penuh menggantikan bahasa lokal.",
                    "Penghapusan sistem kepercayaan animisme dan dinamisme.",
                    "Raja dianggap sebagai titisan dewa secara mutlak tanpa syarat.",
                    "Seluruh sistem hukum adat diganti dengan kitab hukum Manu."
                ],
                correctAnswer: 0
            },
            {
                id: 7,
                question: "Sistem sosial yang dibawa agama Hindu adalah sistem kasta (caturwarna). Namun dalam penerapannya di Indonesia, sistem kasta tidak seketat di India karena...",
                options: [
                    "Pengaruh Buddha yang menentang sistem kasta lebih kuat.",
                    "Masyarakat Indonesia sudah memiliki stratifikasi sosial sendiri yang berakulturasi.",
                    "Kaum brahmana dari India melonggarkan aturannya.",
                    "Semua kasta memiliki hak yang sama dalam politik.",
                    "Sistem kasta hanya berlaku untuk kaum imigran India."
                ],
                correctAnswer: 1
            },
            {
                id: 8,
                question: "Kerajaan Sunda yang bercorak Hindu berkembang di wilayah Jawa Barat dengan ibu kota yang terkenal, yaitu...",
                options: ["Sundapura", "Pakuan Pajajaran", "Kawali", "Galuh", "Batutulis"],
                correctAnswer: 1
            },
            {
                id: 9,
                question: "Raja Kerajaan Sunda yang paling terkenal dan dianggap mencapai puncak kejayaan, serta disebutkan dalam Prasasti Batu Tulis adalah...",
                options: [
                    "Prabu Siliwangi (Sri Baduga Maharaja)",
                    "Rakeyan Jayadarma",
                    "Niskala Wastu Kancana",
                    "Prabu Dewa Niskala",
                    "Sanghyang Surawisesa"
                ],
                correctAnswer: 0
            },
            {
                id: 10,
                question: "Salah satu bukti tertulis keberadaan Kerajaan Sunda adalah Prasasti Kebon Kopi yang ditemukan di Bogor. Prasasti ini terkenal karena terdapat...",
                options: [
                    "Cap dua telapak kaki gajah disertai tulisan berbahasa Melayu Kuno.",
                    "Gambar lingga dan yoni sebagai simbol pemujaan.",
                    "Tulisan mengenai perdagangan lada dengan Portugis.",
                    "Silsilah raja-raja Sunda dari Galuh.",
                    "Kutukan bagi yang melanggar peraturan kerajaan."
                ],
                correctAnswer: 0
            },
            {
                id: 11,
                question: "Sektor ekonomi utama yang menopang kehidupan Kerajaan Sunda adalah...",
                options: [
                    "Perdagangan budak dengan Tiongkok.",
                    "Pertanian (padi dan palawija) dan perdagangan komoditas seperti lada dan garam.",
                    "Industri perkapalan dan galangan kapal.",
                    "Penambangan emas dan perak di pegunungan.",
                    "Peternakan kuda dan kerbau untuk ekspor."
                ],
                correctAnswer: 1
            },
            {
                id: 12,
                question: "Hubungan Kerajaan Sunda dengan bangsa Eropa tercatat dalam sejarah, terutama dengan Portugis. Perjanjian Sunda-Portugal (1522) berisi tentang...",
                options: [
                    "Bantuan militer Portugis untuk menaklukkan Majapahit.",
                    "Kerja sama pembangunan benteng di Sunda Kelapa dan perdagangan lada.",
                    "Pernikahan antara raja Sunda dengan putri Portugis.",
                    "Penyebaran agama Kristen di wilayah Sunda.",
                    "Bantuan Portugis dalam melawan Demak."
                ],
                correctAnswer: 1
            },
            {
                id: 13,
                question: "Berdasarkan naskah kuno seperti Carita Parahyangan, agama yang berkembang di Kerajaan Sunda adalah...",
                options: [
                    "Buddha Mahayana",
                    "Hindu aliran Siwa",
                    "Hindu aliran Wisnu",
                    "Kepercayaan Sunda Wiwitan yang telah berakulturasi dengan Hindu",
                    "Islam"
                ],
                correctAnswer: 3
            },
            {
                id: 14,
                question: "Salah satu faktor yang menyebabkan melemahnya Kerajaan Sunda pada abad ke-16 adalah...",
                options: [
                    "Serangan dari Kerajaan Sriwijaya.",
                    "Konflik internal perebutan takhta dan tekanan dari Kesultanan Banten dan Cirebon yang telah Islam.",
                    "Letusan gunung berapi yang menghancurkan ibu kota.",
                    "Wabah penyakit yang meluas.",
                    "Invasi dari Kerajaan Majapahit."
                ],
                correctAnswer: 1
            },
            {
                id: 15,
                question: "Peninggalan sejarah Kerajaan Sunda yang berupa kompleks percandian dan menjadi situs arkeologi penting adalah...",
                options: [
                    "Candi Cangkuang",
                    "Situs Batutulis",
                    "Candi Jiwa",
                    "Kompleks Candi Bojongmenje",
                    "Arca Ganesha di Pasir Angin"
                ],
                correctAnswer: 3
            }
        ];

        // ============================================
        // VARIABEL GLOBAL
        // ============================================
        let examQuestions = [];
        let currentQuestionIndex = 0;
        let examStarted = false;
        let timeLeft = 825; // 13 menit 45 detik = 825 detik
        let timerInterval = null;
        let studentName = "";
        let studentClass = "";
        let startTime = null;
        let cheatingAttempts = 0;
        let examSubmitted = false;
        let activityLog = [];
        let inFullscreenMode = false;

        // ============================================
        // FUNGSI UTAMA
        // ============================================

        // Fungsi untuk memulai ulangan
        function startExam() {
            // Validasi form
            studentName = document.getElementById('student-name').value.trim();
            studentClass = document.getElementById('student-class').value;
            const honorStatement = document.getElementById('honor-statement').checked;
            
            if (!studentName || !studentClass || !honorStatement) {
                alert('Harap lengkapi semua data dan centang pernyataan kejujuran!');
                return;
            }
            
            // Acak soal
            examQuestions = [...questions];
            shuffleArray(examQuestions);
            
            // Reset data siswa
            examQuestions.forEach(q => {
                q.studentAnswer = null;
                q.timeSpent = 0;
            });
            
            // Set variabel
            currentQuestionIndex = 0;
            examStarted = true;
            timeLeft = 825;
            cheatingAttempts = 0;
            examSubmitted = false;
            startTime = new Date();
            activityLog = [];
            
            // Catat aktivitas
            logActivity(`Mulai ulangan: ${studentName} (${studentClass})`);
            
            // Tampilkan peringatan layar penuh
            document.getElementById('fullscreen-warning').style.display = 'flex';
            document.getElementById('start-page').style.display = 'none';
        }

        // Fungsi untuk mengacak array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Fungsi untuk masuk mode layar penuh
        function enterFullscreen() {
            const elem = document.documentElement;
            
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) { // Safari
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { // IE/Edge
                elem.msRequestFullscreen();
            }
            
            inFullscreenMode = true;
            document.getElementById('fullscreen-warning').style.display = 'none';
            document.getElementById('exam-page').style.display = 'block';
            
            // Mulai timer
            startTimer();
            
            // Tampilkan soal pertama
            showQuestion(currentQuestionIndex);
            
            // Aktifkan keamanan
            enableSecurity();
        }

        // Fungsi untuk memulai timer
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                // Catat waktu untuk soal saat ini
                if (examStarted && !examSubmitted) {
                    examQuestions[currentQuestionIndex].timeSpent++;
                }
                
                // Jika waktu habis
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert('‚è∞ Waktu pengerjaan telah habis!');
                    submitExam(false);
                }
            }, 1000);
        }

        // Fungsi untuk menampilkan timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timerText = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            document.getElementById('timer').textContent = timerText;
            
            // Ubah warna jika waktu hampir habis
            if (timeLeft < 60) {
                document.getElementById('timer').style.color = '#ff5252';
            } else if (timeLeft < 180) {
                document.getElementById('timer').style.color = '#ff9800';
            }
        }

        // Fungsi untuk menampilkan soal
        function showQuestion(index) {
            if (index < 0 || index >= examQuestions.length) return;
            
            currentQuestionIndex = index;
            const question = examQuestions[index];
            
            // Tampilkan soal
            const questionHTML = `
                <div class="question-number">SOAL ${index + 1} / ${examQuestions.length}</div>
                <div class="question-text">${question.question}</div>
                <div class="options-container">
                    ${question.options.map((option, i) => `
                        <div class="option ${question.studentAnswer === i ? 'selected' : ''}" 
                             onclick="selectAnswer(${i})">
                            ${String.fromCharCode(65 + i)}. ${option}
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('current-question').innerHTML = questionHTML;
            
            // Update indikator
            updateQuestionIndicators();
            
            // Update tombol navigasi
            document.getElementById('prev-btn').style.display = index === 0 ? 'none' : 'block';
            document.getElementById('next-btn').style.display = index === examQuestions.length - 1 ? 'none' : 'block';
        }

        // Fungsi untuk memilih jawaban
        function selectAnswer(answerIndex) {
            examQuestions[currentQuestionIndex].studentAnswer = answerIndex;
            
            // Update tampilan
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            options[answerIndex].classList.add('selected');
            
            // Update indikator
            updateQuestionIndicators();
            
            logActivity(`Soal ${currentQuestionIndex + 1}: Pilih ${String.fromCharCode(65 + answerIndex)}`);
        }

        // Fungsi untuk update indikator soal
        function updateQuestionIndicators() {
            const container = document.getElementById('question-indicators');
            let html = '';
            
            examQuestions.forEach((q, i) => {
                let className = 'indicator';
                if (i === currentQuestionIndex) className += ' current';
                if (q.studentAnswer !== null) className += ' answered';
                
                html += `<div class="${className}" onclick="goToQuestion(${i})">${i + 1}</div>`;
            });
            
            container.innerHTML = html;
        }

        // Fungsi untuk pindah ke soal tertentu
        function goToQuestion(index) {
            if (index >= 0 && index < examQuestions.length) {
                showQuestion(index);
            }
        }

        // Fungsi untuk mengaktifkan keamanan
        function enableSecurity() {
            // Blokir klik kanan
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showCheatingWarning();
                logActivity('Klik kanan diblokir');
            });
            
            // Blokir copy-paste
            document.addEventListener('copy', (e) => {
                e.preventDefault();
                showCheatingWarning();
                logActivity('Copy diblokir');
            });
            
            document.addEventListener('cut', (e) => {
                e.preventDefault();
                showCheatingWarning();
                logActivity('Cut diblokir');
            });
            
            document.addEventListener('paste', (e) => {
                e.preventDefault();
                showCheatingWarning();
                logActivity('Paste diblokir');
            });
            
            // Deteksi keluar dari tab
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && examStarted && !examSubmitted) {
                    cheatingAttempts++;
                    showCheatingWarning();
                    logActivity('Keluar dari tab/halaman');
                    
                    if (cheatingAttempts >= 3) {
                        autoSubmitExam('Terlalu sering keluar dari halaman');
                    }
                }
            });
            
            // Deteksi developer tools
            document.addEventListener('keydown', (e) => {
                // F12
                if (e.keyCode === 123) {
                    e.preventDefault();
                    showCheatingWarning();
                    logActivity('Upaya buka developer tools (F12)');
                }
                
                // Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+Shift+C
                if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) {
                    e.preventDefault();
                    showCheatingWarning();
                    logActivity('Upaya buka developer tools (Ctrl+Shift+I/J/C)');
                }
                
                // Ctrl+U (view source)
                if (e.ctrlKey && e.keyCode === 85) {
                    e.preventDefault();
                    showCheatingWarning();
                    logActivity('Upaya view source (Ctrl+U)');
                }
            });
        }

        // Fungsi untuk menampilkan peringatan kecurangan
        function showCheatingWarning() {
            const warning = document.getElementById('cheating-warning');
            warning.style.display = 'block';
            
            setTimeout(() => {
                warning.style.display = 'none';
            }, 3000);
        }

        // Fungsi untuk submit otomatis karena kecurangan
        function autoSubmitExam(reason) {
            if (examSubmitted) return;
            
            logActivity(`Auto-submit: ${reason}`);
            alert(`‚ö†Ô∏è ULANGAN DIKUMPULKAN OTOMATIS!\nAlasan: ${reason}`);
            submitExam(true);
        }

        // Fungsi untuk mengumpulkan ulangan
        function submitExam(isAuto = false) {
            if (examSubmitted) return;
            
            clearInterval(timerInterval);
            examSubmitted = true;
            
            // Hitung waktu
            const endTime = new Date();
            const timeUsed = Math.floor((endTime - startTime) / 1000);
            const timeUsedFormatted = `${Math.floor(timeUsed / 60)}:${(timeUsed % 60).toString().padStart(2, '0')}`;
            
            // Hitung jawaban benar
            let correctCount = 0;
            examQuestions.forEach(q => {
                if (q.studentAnswer === q.correctAnswer) {
                    correctCount++;
                }
            });
            
            // Hitung nilai
            const score = Math.round((correctCount / questions.length) * 10000) / 100;
            
            // Siapkan data untuk Google Sheets
            const submissionData = {
                timestamp: new Date().toISOString(),
                nama: studentName,
                kelas: studentClass,
                nilai: score,
                benar: correctCount,
                salah: questions.length - correctCount,
                waktu: timeUsedFormatted,
                status: isAuto ? 'Dikumpulkan otomatis' : 'Selesai',
                logAktivitas: activityLog.join(' | '),
                waktuPerSoal: examQuestions.map(q => q.timeSpent).join(', '),
                jawabanSiswa: examQuestions.map(q => 
                    q.studentAnswer !== null ? String.fromCharCode(65 + q.studentAnswer) : '-'
                ).join(', ')
            };
            
            // Kirim ke Google Sheets
            sendToGoogleSheets(submissionData);
            
            // Tampilkan hasil
            showResults(score, correctCount, timeUsedFormatted, isAuto);
            
            // Keluar dari fullscreen
            exitFullscreen();
            
            logActivity(`Ulangan selesai. Nilai: ${score}`);
        }

        // Fungsi untuk mengirim data ke Google Sheets
        function sendToGoogleSheets(data) {
            // TAMPILKAN LOADING
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('loading-text').textContent = 'Mengirim hasil ke Google Sheets...';
            
            // URL Google Apps Script Anda - GANTI INI!
            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbySwXUeYPAyEabYwZ_zHOboxA6ToOH2U_9OshMoe-M-gmthj1-SoycfgckhMG0YANwe0w/exec';
            
            // Buat form data
            const formData = new FormData();
            for (const key in data) {
                formData.append(key, data[key]);
            }
            
            // Kirim data
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                console.log('Sukses:', result);
                document.getElementById('loading-text').textContent = 'Berhasil mengirim data!';
                
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 1000);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('loading-text').textContent = 'Gagal mengirim data, hasil disimpan lokal.';
                
                // Simpan data ke localStorage sebagai backup
                localStorage.setItem(`ulangan_${Date.now()}`, JSON.stringify(data));
                
                setTimeout(() => {
                    document.getElementById('loading').style.display = 'none';
                }, 2000);
            });
        }

        // Fungsi untuk menampilkan hasil
        function showResults(score, correctCount, timeUsed, isAuto) {
            document.getElementById('exam-page').style.display = 'none';
            document.getElementById('results-page').style.display = 'block';
            
            document.getElementById('final-score').textContent = score;
            document.getElementById('correct-answers').textContent = `${correctCount}/15`;
            document.getElementById('time-used').textContent = timeUsed;
            
            if (isAuto) {
                document.getElementById('exam-status').textContent = 'OTOMATIS';
                document.getElementById('exam-status').style.color = '#d32f2f';
                document.getElementById('submission-status').textContent = 'Karena kecurangan';
            }
        }

        // Fungsi untuk keluar dari fullscreen
        function exitFullscreen() {
            inFullscreenMode = false;
            
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        // Fungsi untuk mencatat aktivitas
        function logActivity(activity) {
            const timestamp = new Date().toLocaleTimeString();
            activityLog.push(`${timestamp}: ${activity}`);
            
            // Batasi log
            if (activityLog.length > 20) {
                activityLog.shift();
            }
        }

        // Fungsi untuk save sebagai PDF (simulasi)
        function saveAsPDF() {
            document.getElementById('loading').style.display = 'flex';
            document.getElementById('loading-text').textContent = 'Menyimpan hasil...';
            
            setTimeout(() => {
                // Buat konten untuk print
                const printContent = `
                    <html>
                    <head>
                        <title>Hasil Ulangan - ${studentName}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #1a237e; }
                            .info { margin: 20px 0; }
                            .score { font-size: 48px; font-weight: bold; color: #3949ab; }
                        </style>
                    </head>
                    <body>
                        <h1>SMA NEGERI 5 TANAH PUTIH</h1>
                        <h2>Hasil Ulangan Harian Sejarah</h2>
                        <div class="info">
                            <p><strong>Nama:</strong> ${studentName}</p>
                            <p><strong>Kelas:</strong> ${studentClass}</p>
                            <p><strong>Tanggal:</strong> ${new Date().toLocaleDateString()}</p>
                        </div>
                        <div class="score">Nilai: ${document.getElementById('final-score').textContent}</div>
                        <p><strong>Jawaban Benar:</strong> ${document.getElementById('correct-answers').textContent}</p>
                        <p><strong>Waktu Digunakan:</strong> ${document.getElementById('time-used').textContent}</p>
                        <br><br>
                        <p style="font-size: 12px; color: #666;">
                            ¬© 2026 Daniel Riadi Sianipar - Hasil ini sah sebagai bukti pengerjaan ulangan.
                        </p>
                    </body>
                    </html>
                `;
                
                // Buka window untuk print
                const printWindow = window.open('', '_blank');
                printWindow.document.write(printContent);
                printWindow.document.close();
                
                setTimeout(() => {
                    printWindow.print();
                    document.getElementById('loading').style.display = 'none';
                }, 500);
                
            }, 1000);
        }

        // Fungsi untuk kembali ke menu
        function returnToHome() {
            // Reset semua
            examQuestions = [];
            currentQuestionIndex = 0;
            examStarted = false;
            examSubmitted = false;
            cheatingAttempts = 0;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Tampilkan halaman awal
            document.getElementById('results-page').style.display = 'none';
            document.getElementById('exam-page').style.display = 'none';
            document.getElementById('start-page').style.display = 'block';
            
            // Reset form
            document.getElementById('student-form').reset();
            
            logActivity('Kembali ke menu utama');
        }

        // ============================================
        // EVENT LISTENERS
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Tombol mulai
            document.getElementById('start-exam-btn').addEventListener('click', startExam);
            
            // Tombol enter fullscreen
            document.getElementById('enter-fullscreen-btn').addEventListener('click', enterFullscreen);
            
            // Tombol navigasi
            document.getElementById('prev-btn').addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    showQuestion(currentQuestionIndex - 1);
                }
            });
            
            document.getElementById('next-btn').addEventListener('click', () => {
                if (currentQuestionIndex < examQuestions.length - 1) {
                    showQuestion(currentQuestionIndex + 1);
                }
            });
            
            // Tombol finish
            document.getElementById('finish-btn').addEventListener('click', () => {
                const unanswered = examQuestions.filter(q => q.studentAnswer === null).length;
                
                if (unanswered > 0) {
                    if (confirm(`Masih ada ${unanswered} soal belum dijawab. Yakin ingin mengumpulkan?`)) {
                        submitExam(false);
                    }
                } else {
                    submitExam(false);
                }
            });
            
            // Tombol save PDF
            document.getElementById('save-pdf-btn').addEventListener('click', saveAsPDF);
            
            // Tombol kembali
            document.getElementById('return-home-btn').addEventListener('click', returnToHome);
            
            // Deteksi keluar dari fullscreen
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('msfullscreenchange', handleFullscreenChange);
            
            function handleFullscreenChange() {
                const isFullscreen = document.fullscreenElement || 
                                     document.webkitFullscreenElement || 
                                     document.msFullscreenElement;
                
                if (!isFullscreen && inFullscreenMode && examStarted && !examSubmitted) {
                    cheatingAttempts++;
                    showCheatingWarning();
                    logActivity('Keluar dari fullscreen');
                    
                    // Kembalikan ke fullscreen
                    setTimeout(() => {
                        if (!isFullscreen && examStarted && !examSubmitted) {
                            document.getElementById('fullscreen-warning').style.display = 'flex';
                            document.getElementById('exam-page').style.display = 'none';
                        }
                    }, 100);
                    
                    if (cheatingAttempts >= 2) {
                        autoSubmitExam('Keluar dari mode fullscreen berkali-kali');
                    }
                }
            }
            
            // Cegah zoom pada mobile
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) {
                    e.preventDefault();
                    showCheatingWarning();
                }
            }, { passive: false });
            
            // Handle logo error
            document.getElementById('school-logo').addEventListener('error', function() {
                this.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%231a237e"/><text x="50" y="50" font-family="Arial" font-size="40" fill="white" text-anchor="middle" dy=".3em">SMA5</text></svg>';
            });
            
            logActivity('Halaman dimuat');
        });
    </script>
</body>
</html>
